<!DOCTYPE html>
<html>
<head>
    <title>Login Check & Photo Test</title>
    <style>
        body { font-family: system-ui; padding: 20px; max-width: 1000px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .error { background: #fff0f0; border-color: #ff0000; }
        .success { background: #f0fff0; border-color: #00aa00; }
        .warning { background: #fff8f0; border-color: #ff8800; }
        .info { background: #f0f8ff; border-color: #0088ff; }
        button { padding: 12px 24px; margin: 8px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; }
        button:hover { background: #0056b3; }
        button.secondary { background: #6c757d; }
        button.success { background: #28a745; }
        button.danger { background: #dc3545; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .step { margin: 15px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #007bff; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üîß Fix Wanderplan Photo Issues - Step by Step</h1>
    
    <div class="section info">
        <h2>üìã Current Status</h2>
        <div id="current-status">Checking...</div>
        <button onclick="checkCurrentStatus()">Refresh Status</button>
    </div>
    
    <div class="step">
        <h3>Step 1: Login to Wanderplan</h3>
        <p>First, let's make sure you're logged in and have access to your trips.</p>
        <button onclick="openWanderplan()">Open Wanderplan</button>
        <button onclick="checkLoginStatus()" class="secondary">Check Login Status</button>
        <div id="login-status"></div>
    </div>
    
    <div class="step">
        <h3>Step 2: Verify or Create Trips</h3>
        <p>Once logged in, let's check if you have any trips or create a test trip.</p>
        <button onclick="checkTrips()">Check My Trips</button>
        <button onclick="createTestTrip()" class="success">Create Test Trip</button>
        <div id="trip-status"></div>
    </div>
    
    <div class="step">
        <h3>Step 3: Test Photo Functionality</h3>
        <p>Test if photos work on your existing trips.</p>
        <button onclick="testPhotoFeature()">Test Photo Feature</button>
        <div id="photo-status"></div>
    </div>
    
    <div class="step">
        <h3>Step 4: Manual Fix Instructions</h3>
        <div id="manual-instructions">
            <ol>
                <li><strong>Login:</strong> Go to Wanderplan and login/register</li>
                <li><strong>Create Trip:</strong> Create a new trip (like "Test Paris Trip")</li>
                <li><strong>Add Places:</strong> Let it generate places or add manually</li>
                <li><strong>Click "Add Photos":</strong> Look for the button next to "Add Item"</li>
                <li><strong>Wait:</strong> Photos should appear after a few seconds</li>
            </ol>
        </div>
    </div>

    <script>
        function openWanderplan() {
            window.open('http://localhost:5173', '_wanderplan');
        }
        
        function checkCurrentStatus() {
            const status = document.getElementById('current-status');
            
            // Check user login
            const user = localStorage.getItem('wanderplan_user');
            const session = localStorage.getItem('wanderplan_session');
            const trips = JSON.parse(localStorage.getItem('wanderplan_trips') || '[]');
            const places = JSON.parse(localStorage.getItem('wanderplan_places') || '[]');
            
            let html = '<h4>Current Status:</h4>';
            
            if (user && session) {
                const userData = JSON.parse(user);
                html += `<p class="success">‚úÖ Logged in as: ${userData.email}</p>`;
            } else {
                html += '<p class="error">‚ùå Not logged in</p>';
            }
            
            html += `<p>Trips: ${trips.length}</p>`;
            html += `<p>Places: ${places.length}</p>`;
            
            if (trips.length > 0) {
                html += '<p class="success">‚úÖ You have trips - photos should work!</p>';
            } else {
                html += '<p class="warning">‚ö†Ô∏è No trips found - need to create or login</p>';
            }
            
            status.innerHTML = html;
        }
        
        function checkLoginStatus() {
            const status = document.getElementById('login-status');
            const user = localStorage.getItem('wanderplan_user');
            const session = localStorage.getItem('wanderplan_session');
            
            if (user && session) {
                const userData = JSON.parse(user);
                const sessionExpiry = localStorage.getItem('wanderplan_session_expiry');
                const isValid = sessionExpiry && parseInt(sessionExpiry) > Date.now();
                
                status.innerHTML = `
                    <div class="success">
                        <h4>‚úÖ Login Status: Logged In</h4>
                        <p>User: ${userData.email}</p>
                        <p>Session Valid: ${isValid ? 'Yes' : 'Expired'}</p>
                    </div>
                `;
            } else {
                status.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Login Status: Not Logged In</h4>
                        <p>You need to login to Wanderplan first.</p>
                        <button onclick="openWanderplan()">Go to Wanderplan</button>
                    </div>
                `;
            }
        }
        
        function checkTrips() {
            const status = document.getElementById('trip-status');
            const trips = JSON.parse(localStorage.getItem('wanderplan_trips') || '[]');
            const places = JSON.parse(localStorage.getItem('wanderplan_places') || '[]');
            
            if (trips.length === 0) {
                status.innerHTML = `
                    <div class="warning">
                        <h4>‚ö†Ô∏è No Trips Found</h4>
                        <p>You don't have any trips yet. Let's create one!</p>
                    </div>
                `;
            } else {
                let html = `<div class="success"><h4>‚úÖ Found ${trips.length} trips:</h4>`;
                
                trips.forEach(trip => {
                    const tripPlaces = places.filter(p => p.trip_id === trip.id);
                    const placesWithPhotos = tripPlaces.filter(p => p.photo_url);
                    
                    html += `
                        <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 4px;">
                            <strong>${trip.title}</strong><br>
                            ${tripPlaces.length} places (${placesWithPhotos.length} with photos)<br>
                            <a href="http://localhost:5173/trip/${trip.id}" target="_wanderplan">Open Trip</a>
                        </div>
                    `;
                });
                
                html += '</div>';
                status.innerHTML = html;
            }
        }
        
        function createTestTrip() {
            const status = document.getElementById('trip-status');
            status.innerHTML = `
                <div class="info">
                    <h4>üèóÔ∏è Creating Test Trip</h4>
                    <p>I'll open Wanderplan's trip creation page for you:</p>
                    <ol>
                        <li>Choose "Plan a new trip"</li>
                        <li>Enter "Paris" as destination</li>
                        <li>Set dates and preferences</li>
                        <li>Let it generate places</li>
                        <li>Look for "Add Photos" button</li>
                    </ol>
                </div>
            `;
            
            // Open trip creation
            window.open('http://localhost:5173', '_wanderplan');
        }
        
        function testPhotoFeature() {
            const status = document.getElementById('photo-status');
            const trips = JSON.parse(localStorage.getItem('wanderplan_trips') || '[]');
            
            if (trips.length === 0) {
                status.innerHTML = `
                    <div class="error">
                        <h4>‚ùå No Trips to Test</h4>
                        <p>Create a trip first, then come back to test photos.</p>
                    </div>
                `;
                return;
            }
            
            // Open the first trip
            const firstTrip = trips[0];
            status.innerHTML = `
                <div class="info">
                    <h4>üß™ Testing Photos on: ${firstTrip.title}</h4>
                    <p>Opening trip... Look for the "Add Photos" button next to "Add Item"</p>
                    <p>If you see the button, click it and wait for photos to load!</p>
                </div>
            `;
            
            window.open(`http://localhost:5173/trip/${firstTrip.id}`, '_wanderplan');
        }
        
        // Auto-check status on load
        window.addEventListener('load', () => {
            checkCurrentStatus();
            checkLoginStatus();
        });
    </script>
</body>
</html>
