<!DOCTYPE html>
<html>
<head>
    <title>Wanderplan Storage Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .code { font-family: monospace; background: #000; color: #0f0; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üîç Wanderplan Storage Debug Tool</h1>
    
    <button onclick="checkStorage()">Check Storage Contents</button>
    <button onclick="showAllKeys()">Show All Storage Keys</button>
    <button onclick="clearAllData()">Clear All Data</button>
    
    <div id="results"></div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += '<div class="result">' + message + '</div>';
        }

        function checkStorage() {
            document.getElementById('results').innerHTML = '';
            
            log('<h3>üîç Checking Storage Contents...</h3>');
            
            // Check for trips
            const trips = JSON.parse(localStorage.getItem('wanderplan_trips') || 'null');
            log('<strong>Trips:</strong> ' + (trips ? trips.length + ' found' : 'null/empty'));
            if (trips && trips.length > 0) {
                log('<div class="code">' + JSON.stringify(trips.map(t => ({
                    id: t.id,
                    title: t.title,
                    created_by: t.created_by
                })), null, 2) + '</div>');
            }
            
            // Check for places
            const places = JSON.parse(localStorage.getItem('wanderplan_places') || 'null');
            log('<strong>Places:</strong> ' + (places ? places.length + ' found' : 'null/empty'));
            if (places && places.length > 0) {
                log('<div class="code">' + places.length + ' places found</div>');
            }
            
            // Check for users
            const users = JSON.parse(localStorage.getItem('wanderplan_users') || 'null');
            log('<strong>Users:</strong> ' + (users ? users.length + ' found' : 'null/empty'));
            if (users && users.length > 0) {
                log('<div class="code">' + JSON.stringify(users.map(u => ({
                    id: u.id,
                    email: u.email,
                    full_name: u.full_name
                })), null, 2) + '</div>');
            }
            
            // Check current user
            const currentUser = JSON.parse(localStorage.getItem('wanderplan_user') || 'null');
            log('<strong>Current User:</strong> ' + (currentUser ? currentUser.email + ' (' + currentUser.id + ')' : 'null/empty'));
            
            // Check auth token
            const authToken = localStorage.getItem('authToken');
            log('<strong>Auth Token:</strong> ' + (authToken ? 'exists' : 'missing'));
        }

        function showAllKeys() {
            document.getElementById('results').innerHTML = '';
            log('<h3>üóùÔ∏è All Storage Keys:</h3>');
            
            const keys = Object.keys(localStorage).filter(key => 
                key.includes('wanderplan') || key.includes('auth')
            );
            
            if (keys.length === 0) {
                log('No Wanderplan-related keys found');
                return;
            }
            
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                const preview = value.length > 100 ? value.substring(0, 100) + '...' : value;
                log('<strong>' + key + ':</strong> ' + preview);
            });
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL Wanderplan data? This cannot be undone!')) {
                const keys = Object.keys(localStorage).filter(key => 
                    key.includes('wanderplan') || key.includes('auth')
                );
                
                keys.forEach(key => localStorage.removeItem(key));
                log('<h3>üóëÔ∏è Cleared ' + keys.length + ' storage keys</h3>');
            }
        }

        // Auto-run check on load
        window.onload = checkStorage;
    </script>
</body>
</html>